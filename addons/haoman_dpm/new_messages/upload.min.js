$.fn.upload_image = function (e) {
    $(this).change(function (a) {
        if (1 == isback)
        {
            $.tip("您已经被禁言,不能上传图片了");
            return;
        }
        var t = this;
        if ("" != $(this).val() && null != $(this).val()) {
            $.showLoading("上传中...");
            var n = a.target.files[0], i = n.type, s = !1;
            if (null != i && "" != i || (i = $(this).attr("accept"), s = !0), !n.type.match("image.*"))return $.hideLoading(), $.alert("亲，部分手机系统导致无法识别您的上传的文件，请直接拍照上传"), !1;
            n.type.match("image.*") && lrz(n, {width: 1080}).then(function (a) {
                a.formData.append('fileLen', a.fileLen);

                $.ajax({
                    url: go_UploadImage, // 这个地址做了跨域处理，可以用于实际调试
                    data: a.formData,
                    processData: false,
                    contentType: false,
                    dataType:  'json',
                    type: 'POST',
                    success: function (data) {
                        var  pic_url = data.filename;
                        e(pic_url)
                    }

                })
            }).catch(function (e) {
                alert("图片上传失败:" + e)
            }).always(function () {

            })
        }
    })
}, $.fn.upload_video = function (e) {
    $(this).change(function (a) {
        if (1 == isback)
        {
            $.tip("您已经被禁言,不能上传视频了");
            return;
        }
        if ("" != $(this).val() && null != $(this).val()) {
            $.showLoading("上传中...");
            var t = a.target.files[0], n = t.type, i = !1;
            if (null != n && "" != n || (n = $(this).attr("accept"), i = !0), !t.type.match("video.*"))return $.hideLoading(), $.alert("亲，部分手机系统导致无法识别您的上传的文件，请直接拍摄上传"), !1;

            if (t.type.match("video.*")) {

                var o = new FormData;
                var i = t.name, a = i.substring(i.lastIndexOf(".") + 1);
                o.append("file", t, i),

                    $.ajax({
                        url: go_UploadImage,
                        data: o,
                        dataType: "json",
                        processData: !1,
                        contentType: !1,
                        type: "POST",
                        success: function (data) {
                            if(data.filename){
                                var  pic_url = data.filename;
                                e(pic_url, "video")
                            }else {

                                alert(data.message);
                                $.loadingModal(!1)
                            }
                        },
                        error:function(data){

                            alert(data.message);
                            $.loadingModal(!1);
                        }

                    })
            }
            // if (t.type.match("video.*")) {
            //     var s = new FormData;
            //     $.getJSON("/oss", function (a) {
            //         var n = t.name;
            //         i ? (sec_name = "mp4", n = Date.parse(new Date) + Math.ceil(9999 * Math.random())) : sec_name = n.substring(n.lastIndexOf(".") + 1), s.append("OSSAccessKeyId", a.accessid), s.append("policy", a.policy), s.append("Signature", a.signature), s.append("key", a.dir + a.filename + "." + sec_name), s.append("success_action_status", 201), s.append("file", t, n), $.ajax({
            //             url: a.host,
            //             data: s,
            //             dataType: "xml",
            //             processData: !1,
            //             contentType: !1,
            //             type: "POST",
            //             xhr: function () {
            //                 var e = $.ajaxSettings.xhr();
            //                 return e.upload && e.upload.addEventListener("progress", function (e) {
            //                 }, !1), e
            //             }
            //         }).done(function (a) {
            //             if ($(a).find("PostResponse")) {
            //                 var t = $(a).find("PostResponse").find("Location").text(),
            //                     n = t.substring(t.lastIndexOf(".") + 1);
            //                 if ("-1" == ["mp4", "MP4", "webm", "WEBM", "mov", "MOV"].indexOf(n))return $.hideLoading(), $.alert("上传失败，仅支持mp4,webm,mov格式的视频"), !1;
            //                 e(t, "video")
            //             }
            //         })
            //     })
            // }
        }
    })
};