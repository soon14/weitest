var control = {
    faceUrl: "../addons/haoman_base/dpm/face/",
    face: ["[笑哈哈]", "[得瑟]", "[得意地笑]", "[转圈]", "[挤地铁]", "[我忍了]", "[粉爱你]", "[粉红兔火车]", "[转圈圈]", "[鼓掌]", "[压力]", "[抢镜]", "[草泥马]", "[神马]", "[多云]", "[给力]", "[围观]", "[v5]", "[小熊猫]", "[粉红兔微笑]", "[动感光波]", "[囧]", "[互粉]", "[礼物]", "[微笑]", "[呲牙笑]", "[大笑]", "[羞羞]", "[小可怜]", "[抠鼻孔]", "[惊讶]", "[大眼睛羞涩]", "[吐舌头]", "[闭嘴]", "[鄙视]", "[爱你哦]", "[泪牛满面]", "[偷笑]", "[嘴一个]", "[生病]", "[装可爱]", "[切~]", "[右不屑]", "[左不屑]", "[嘘]", "[雷人]", "[呕吐]", "[委屈]", "[装可爱]", "[再见]", "[疑问]", "[困]", "[money]", "[装酷]", "[色眯眯]", "[ok]", "[good]", "[nonono]", "[赞一个]", "[弱]"],
    init: function (e) {
        for (var i = $("<div class='first_line'></div>"), n = $("<div class='sec_line'></div>"), t = 1; t <= this.face.length; t++) {
            var a = '<a index="' + t + '" class="smile_img"><img src="' + this.faceUrl + t + '.png" /></a>';
            t % 2 == 1 ? i.append(a) : n.append(a)
        }
        var l = 58 * (this.face.length / 2 + 1);
        i.width(l), n.width(l), e.find(".msg_input_face").append(i).append(n).append("<div style='clear:both'></div>").find(".smile_img").click(function () {
            control.setFace(this, e.find(".msg_input_box"))
        })
    },
    insertHtml: function (e, i) {
        var n = i[0];
        if (document.selection) {
            var t = document.selection.createRange();
            t.text = e, i.blur()
        } else if ("number" == typeof n.selectionStart && "number" == typeof n.selectionEnd) {
            var a = n.selectionStart, l = n.selectionEnd, r = a, c = n.value;
            n.value = c.substring(0, a) + e + c.substring(l, c.length), r += e.length, n.selectionStart = n.selectionEnd = r, i.blur()
        } else n.value += e, i.blur()
    },
    setFace: function (e, i) {
        this.insertHtml(this.face[parseInt($(e).attr("index")) - 1], i)
    },
    initFace: function (e) {
        for (var i = this.face, n = 0; n < e.length; n++) {
            for (var t = e[n].innerHTML, a = 0; a < i.length; a++)for (; t.indexOf(i[a]) != -1;)t = t.replace(i[a], '<img style="width:32px;height:32px; vertical-align:middle; margin:0 2px" src="' + this.faceUrl + "/" + (a + 1) + '.png" />');
            e[n].innerHTML = t
        }
    },
    replaceText: function (e) {
        for (var i = this.face, n = 0; n < i.length; n++)for (; e.indexOf(i[n]) != -1;)e = e.replace(i[n], '<img style="width:32px;height:32px;vertical-align:middle; margin:0 2px" src="' + this.faceUrl + "/" + (n + 1) + '.png" />');
        return e
    }
};
$.fn.smile = function (e) {
    var i = $(this);
    "init" == e && control.init(i), control.initFace(i.find(".msg_list"))
};