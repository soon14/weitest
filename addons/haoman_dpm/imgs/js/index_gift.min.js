function gift_selection_render() {
    $.TouchSlide({
        slideCell: "#send-gift-content",
        titCell: ".fl-slide-pager ul",
        mainCell: ".fl-slide-content",
        autoPage: !0
    }), $(".fl-el-item").click(function () {
        $(this).attr("data-image");
        to_user.item_id = $(this).attr("data-id"), $(".fl-el-item.selected").removeClass("selected"), $(this).addClass("selected");
        var e = $(this).attr("data-fee");
        e = parseFloat(e), to_user.item_price = e;
        var t = $("#number").val();
        t = parseInt(t), (isNaN(t) || t <= 0) && (t = 1), to_user.item_number = t, $("#number").val(t), calculate_fee()
    })
}
function calculate_fee() {
    if (void 0 == to_user.item_id || 0 == to_user.item_id)return $(".el-price").text("0.00"), !1;
    var e = to_user.item_price * to_user.item_number;
    $(".el-price").text(e.toFixed(2))
}
function refresh_user_list(e, t) {
    filter.type = e, filter.page = 0, page = 0, user_list = {}, $(".user-filter-item.active").removeClass("active"), $(t).parent().addClass("active"), $(".user_panel .user-list").empty(), load_user_list()
}
function load_user_list() {
    loading || page != filter.page || (console.info("loading"), loading = !0, $(".loading").show(), $.post(get_moreUsers, filter, function (e) {
        e.count && (filter.page++, page++, render_user_list(e.list)), loading = !1, $(".loading").hide()
    }, "json"))
}
function render_user_list(e) {

    var t = $(".user-rows:last-child");
    cnt = t.find(".user-item").length;

    for (var i = 0; i < e.length; i++) {
        var a = e[i];
        if (void 0 == user_list[a.from_user] && (user_list[a.from_user] = a, cnt % 3 == 0 && (null != t && $(".user_panel .user-list").append(t), t = $('<div class="user-rows"></div>')), null != a.avatar && "" != a.avatar)) {
            a.avatar.indexOf("/") ? a.avatar = a.avatar.replace("/0", "/132") : a.avatar += "/132";
            var r = '<div class="user-item ' + a.sex + '" data-id="' + a.from_user + '" onclick="send_gift(this)"><div class="avatar" style="background-image: url(' + a.avatar + ')"></div><div class="user-info"><div class="nickname">' + a.nickname + "</div></div></div>";
            $(t).append(r), cnt++
        }
    }
    "" != $(t).html() && ($(".user_panel .user-list").append(t), t = null)
}
function send_gift(e) {
    to_user.uid = $(e).attr("data-id"), $(".el-to-user-name").text(user_list[to_user.uid].nickname), $(".el_panel").show(), gift_selection_render()
}
function send_gift_direct(e) {
    to_user.uid = e.uid, $(".el-to-user-name").text(e.nickname), $(".el_panel").show(), gift_selection_render()
}
var user_list = {}, loading = !1, filter = {type: 0, page: 0}, page = 0, to_user = {};
$(function () {
    function e(e) {
        var t = $(this).scrollTop(), i = $(document).height(), a = $(this).height();
        $(".user-filter").height();
        t + a + 200 >= i && load_user_list()
    }

    $(window).scroll(e), $("#number").blur(function () {
        var e = $(this).val();
        e = parseInt(e), (isNaN(e) || e <= 0) && (e = 1), to_user.item_number = e, $(this).val(e), calculate_fee()
    }), $(".fl-number-picker-add").click(function () {
        var e = $("#number").val();
        e = parseInt(e), (isNaN(e) || e <= 0) && (e = 0), e++, to_user.item_number = e, e > 1 && $(".fl-number-picker-minus").addClass("enabled"), $("#number").val(e), calculate_fee()
    }), $(".fl-number-picker-minus").click(function () {
        var e = $("#number").val();
        e = parseInt(e), (isNaN(e) || e <= 0) && (e = 1), e > 1 && e--, 1 == e && $(this).removeClass("enabled"), to_user.item_number = e, $("#number").val(e), calculate_fee()
    }), $(".close,#el-back-btn").click(function () {
        $(".el_panel").hide(), to_user.uid = 0,click=false;
    });
});