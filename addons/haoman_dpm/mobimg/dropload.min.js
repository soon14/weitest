!function(x){function r(b){b.touches||(b.touches=b.originalEvent.touches)}function q(d,c){c._startY=d.touches[0].pageY,c.touchScrollTop=c.$scrollArea.scrollTop()}function p(a,f){f._curY=a.touches[0].pageY,f._moveY=f._curY-f._startY,f._moveY>0?f.direction="down":f._moveY<0&&(f.direction="up");var e=Math.abs(f._moveY);""!=f.opts.loadUpFn&&f.touchScrollTop<=0&&"down"==f.direction&&!f.isLockUp&&(a.preventDefault(),f.$domUp=x("."+f.opts.domUp.domClass),f.upInsertDOM||(f.$element.prepend('<div class="'+f.opts.domUp.domClass+'"></div>'),f.upInsertDOM=!0),m(f.$domUp,0),e<=f.opts.distance?(f._offsetY=e,f.$domUp.html(f.opts.domUp.domRefresh)):e>f.opts.distance&&e<=2*f.opts.distance?(f._offsetY=f.opts.distance+0.5*(e-f.opts.distance),f.$domUp.html(f.opts.domUp.domUpdate)):f._offsetY=f.opts.distance+0.5*f.opts.distance+0.2*(e-2*f.opts.distance),f.$domUp.css({height:f._offsetY}))}function o(a){var d=Math.abs(a._moveY);""!=a.opts.loadUpFn&&a.touchScrollTop<=0&&"down"==a.direction&&!a.isLockUp&&(m(a.$domUp,300),d>a.opts.distance?(a.$domUp.css({height:a.$domUp.children().height()}),a.$domUp.html(a.opts.domUp.domLoad),a.loading=!0,a.opts.loadUpFn(a)):a.$domUp.css({height:"0"}).on("webkitTransitionEnd transitionend",function(){a.upInsertDOM=!1,x(this).remove()}),a._moveY=0)}function n(b){b._scrollContentHeight=b.opts.scrollArea==w?t.height():b.$element[0].scrollHeight}function m(d,c){d.css({"-webkit-transition":"all "+c+"ms",transition:"all "+c+"ms"})}var s,w=window,v=document,u=x(w),t=x(v);x.fn.dropload=function(b){return new s(this,b)},s=function(a,f){var e=this;e.$element=x(a),e.upInsertDOM=!1,e.loading=!1,e.isLockUp=!1,e.isLockDown=!1,e.isData=!0,e._scrollTop=0,e.init(f)},s.prototype.init=function(c){function a(){b.direction="up",b.$domDown.html(b.opts.domDown.domLoad),b.loading=!0,b.opts.loadDownFn(b)}var b=this;b.opts=x.extend({},{scrollArea:b.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},distance:50,threshold:"",loadUpFn:"",loadDownFn:""},c),""!=b.opts.loadDownFn&&(b.$element.append('<div class="'+b.opts.domDown.domClass+'">'+b.opts.domDown.domRefresh+"</div>"),b.$domDown=x("."+b.opts.domDown.domClass)),b.opts.scrollArea==w?(b.$scrollArea=u,b._scrollContentHeight=t.height(),b._scrollWindowHeight=v.documentElement.clientHeight):(b.$scrollArea=b.opts.scrollArea,b._scrollContentHeight=b.$element[0].scrollHeight,b._scrollWindowHeight=b.$element.height()),b._scrollContentHeight<=b._scrollWindowHeight&&a(),u.on("resize",function(){b._scrollWindowHeight=b.opts.scrollArea==w?w.innerHeight:b.$element.height()}),b.$element.on("touchstart",function(d){b.loading||(r(d),q(d,b))}),b.$element.on("touchmove",function(d){b.loading||(r(d,b),p(d,b))}),b.$element.on("touchend",function(){b.loading||o(b)}),b.$scrollArea.on("scroll",function(){b._scrollTop=b.$scrollArea.scrollTop(),b._threshold=""===b.opts.threshold?Math.floor(1*b.$domDown.height()/3):b.opts.threshold,""!=b.opts.loadDownFn&&!b.loading&&!b.isLockDown&&b._scrollContentHeight-b._threshold<=b._scrollWindowHeight+b._scrollTop&&a()})},s.prototype.lock=function(d){var c=this;void 0===d?"up"==c.direction?c.isLockDown=!0:"down"==c.direction?c.isLockUp=!0:(c.isLockUp=!0,c.isLockDown=!0):"up"==d?c.isLockUp=!0:"down"==d&&(c.isLockDown=!0)},s.prototype.unlock=function(){var b=this;b.isLockUp=!1,b.isLockDown=!1},s.prototype.noData=function(){var b=this;b.isData=!1},s.prototype.resetload=function(){var a=this;"down"==a.direction&&a.upInsertDOM?a.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){a.loading=!1,a.upInsertDOM=!1,x(this).remove(),n(a)}):"up"==a.direction&&(a.loading=!1,a.isData?(a.$domDown.html(a.opts.domDown.domRefresh),n(a)):a.$domDown.html(a.opts.domDown.domNoData))}}(window.Zepto||window.jQuery);