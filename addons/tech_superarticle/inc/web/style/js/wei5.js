$(function(){({init:function(){var a=this;a.loadEditor(function(){a.editTools=$("#J-editTools");a.clearEditor();a.appendToEditor();a.tabSwitch();a.zeroClipboard();a.closeConfirm();a.view();a.selectColor();a.showColBox();a.scrollLoadPic();a.loadPic();a.checkSelete();a.moveFixedTools()})},loadEditor:function(a){var b=this,c=location.pathname;b.loadStartLoadEditor=!0;UEDITOR_CONFIG.toolbars=["fullscreen source | undo redo | bold italic underline fontborder strikethrough superscript subscript removeformat formatmatch autotypeset pasteplain | forecolor backcolor insertorderedlist insertunorderedlist indent rowspacingtop rowspacingbottom lineheight | fontfamily fontsize justifyleft justifycenter justifyright justifyjustify insertimage emotion | horizontal spechars inserttable".split(" ")];
UEDITOR_CONFIG.initialStyle="body{font-size:14px;font-family:MicroSoft YaHei}";b.UE=UE.getEditor("myEditor");b.UE.addListener("selectionchange",function(){b.setEditerTools()});b.UE.addListener("blur",function(){b.editTools.hide()});b.setContentByLocal();"function"===typeof a&&a()},appendToEditor:function(){var a=this;$("#tm_tagContent").on("click",
".tag-item",function(){var b=$(this).html();a.UE.selection.getRange().select();a.UE.selection.getText();a.UE.execCommand("insertHtml",b)})},clearEditor:function(){var a=this;$("#tm_clearEditor").on("click",function(){$.dialog.confirm({type:"warning",move:!0,title:"\u8b66\u544a",content:"\u662f\u5426\u786e\u8ba4\u5220\u9664\uff0c\u5220\u9664\u540e\u4e0d\u53ef\u6062\u590d!",callback:function(b){b.result&&(a.UE.setContent(""),localStorage.setItem("ueditor_preference",""),a.editTools.hide())}})})},zeroClipboard:function(){var a=
this,b=new ZeroClipboard($(".copy-editor-html"));ZeroClipboard.config({swfPath:"/js/ZeroClipboard.swf"});b.on("ready",function(c){b.on("copy",function(c){a.getContent(function(a){c.clipboardData.setData("text/html",a);c.clipboardData.setData("text/plain",a)})});b.on("aftercopy",function(a){$.dialog.alert({type:"right",move:!0,content:"\u6b63\u6587\u5185\u5bb9\u5df2\u7ecf\u590d\u5236\u5230\u526a\u5207\u677f\uff0c\u53ef\u7c98\u8d34\uff08ctrl+v\uff09\u5230\u5fae\u4fe1\u516c\u4f17\u5e73\u53f0\u7f16\u8f91\u5668\u4e2d\u4f7f\u7528\uff01"})})})},
getContent:function(a){var b=$(document.getElementById("ueditor_0").contentWindow.document.body).clone();b.find(".96wx-img").each(function(){var a=$(this),d=a.attr("src"),b=a.data("wxsrc");tools.isNotEmpty(b)&&-1!=d.indexOf("cdn.96weixin.com")&&a.attr("src",b).removeAttr("data-wxsrc")});b.find(".96wx-bgpic").each(function(){var a=$(this),d=a.css("background-image"),b=a.css("-webkit-border-image"),e=a.data("wxsrc"),f=a.prop("outerHTML");tools.isNotEmpty(e)&&(tools.isNotEmpty(d)&&"none"!=d&&"initial"!=
d&&"inherit"!=d&&-1==d.indexOf("https://mmbiz.qlogo.cn")&&a.css("background-image","url("+e+")"),tools.isNotEmpty(b)&&"none"!=b&&"initial"!=b&&"inherit"!=b&&-1==b.indexOf("https://mmbiz.qlogo.cn")&&(f=f.replace(/url\(([^(]*)\)/gi,"url("+e+")"),a.after($(f)),a.remove()))});b=b.html();b=b.replace(/_src="([^"]*)"/gi,"").replace(/data-wxsrc="([^"]*)"/gi,"").replace(/96wx-img/g,"").replace(/96wx-bgpic/g,"");"function"===typeof a&&a(b)},editorItemSelect:function(){$(document.getElementById("ueditor_0").contentWindow.document.body).off().on("click",
".wx96Diy",function(){$(this).toggleClass("cur").siblings().removeClass("cur")})},setContentByLocal:function(){var a=this,b=null;a.UE.addListener("ready",function(){a.editorItemSelect();a.editorIframe=$(document.getElementById("ueditor_0").contentWindow.document.body);a.windowScroll();a.editorScroll();var c=localStorage.getItem("ueditor_preference");if(tools.isNotEmpty(c)){var d;try{d=JSON.parse(c)}catch(g){throw Error("JSON\u683c\u5f0f\u7684\u6570\u636e\u6709\u8bef\uff0c\u8f6c\u5316\u5931\u8d25!");
}d.wx005Edit&&a.UE.setContent(d.wx005Edit)}b=setTimeout(function(){a.loadStartLoadEditor=!1;clearTimeout(b)},1E3)})},saveContent:function(){var a=this.UE.getContent();localStorage.setItem("ueditor_preference",JSON.stringify({wx005Edit:a}))},setEditerTools:function(a){function b(a){c.editTools.off().on("click","span",function(){switch($(this).data("operate")){case "delete":c.curDiy.remove();c.editTools.hide();break;case "insert-before":$("<p>&nbsp;</p>").insertBefore(c.curDiy);break;case "insert-after":$("<p>&nbsp;</p>").insertAfter(c.curDiy);
break;case "up":c.curDiy.insertBefore(c.curDiy.prev());break;case "down":c.curDiy.insertAfter(c.curDiy.next())}c.saveContent()});a=new ZeroClipboard(c.editTools.find("span:eq(0)"));var b=new ZeroClipboard(c.editTools.find("span:eq(1)"));ZeroClipboard.config({swfPath:"/js/ZeroClipboard.swf"});a.on("copy",function(a){var b=c.curDiy.prop("outerHTML");a.clipboardData.setData("text/html",b);a.clipboardData.setData("text/plain",b)});b.on("copy",function(a){var b=c.curDiy.prop("outerHTML");a.clipboardData.setData("text/html",
b);a.clipboardData.setData("text/plain",b)});b.on("aftercopy",function(a){c.curDiy.remove();c.saveContent();c.editTools.hide()})}var c=this;if(!c.loadStartLoadEditor){var d=c.UE.selection.getRange();a=d.getClosedNode();var d=d.getCommonAncestor(),d=$(d).closest(".wx96Diy"),g,e=0;tools.isEmpty(d)||!d.hasClass("wx96Diy")?(c.editTools.hide(),c.editorIframe.find(".wx96Diy").removeClass("cur")):(e=a&&"IMG"==a.tagName?13:0,a=d.get(0).getBoundingClientRect().top+$("#ueditor_0").get(0).getBoundingClientRect().top,
g=d.get(0).getBoundingClientRect().left+$("#ueditor_0").get(0).getBoundingClientRect().left,diyWidth=d.outerWidth(),diyHeight=d.outerHeight(),c.editTools.css({top:a+diyHeight+e,left:g+diyWidth-332}),c.editTools.is(":hidden")&&c.editTools.show(),c.curDiy=d,c.copyIsLoad||(c.copyIsLoad=!0,b()))}},tabSwitch:function(){var a=this,b=$("#tm_tableShow"),c=$("#tm_tagContent").find(".con-tag-wrap"),d=!1;b.find("li").off("click").on("click",function(){var b=$(this),e=b.data("tag"),f=b.index();if(!d&&!tools.isEmpty(e)){d=
!0;b.removeClass("cur").addClass("cur").siblings().removeClass("cur");if(c.eq(f).hasClass("loaded"))return c.eq(f).removeClass("on").addClass("on").siblings().removeClass("on"),d=!1;c.eq(f).html("<div class='loading'>\u6570\u636e\u52a0\u8f7d\u4e2d...</div>").removeClass("on loaded").addClass("on loaded").siblings().removeClass("on");$.ajax({type:"post",url:"/tmSeach/"+e+"/0/0",error:function(){d=!1},success:function(b){tools.isNotEmpty(b)&&c.eq(f).html(b);d=!1;a.loadPic()}})}})},closeConfirm:function(){function a(a){return"\u8bf7\u786e\u8ba4\u60a8\u5f53\u524d\u7684\u5185\u5bb9\u5df2\u7ecf\u59a5\u5584\u8f6c\u5b58\uff01"}
function b(){var a=c.UE.getContent();return tools.isEmpty(a)?!1:!0}var c=this;window.onbeforeunload=window.Event?function(c){if(b())return a(c)}:function(){if(b())return a(event)}},view:function(){var a=this,b=null,c=$("#tm_mobileView"),d=$("body"),g="";c.on("click",function(){$.ajax({url:"/statics/mobile.html/",success:function(c){b=$(c);g=a.UE.getContent();d.append(b);b.find("#content").html(g);b.fadeIn();d.css("overflow","hidden")}})});d.on("click",".tm_closeBtn",function(){b.fadeOut(function(){$(this).remove();
d.removeAttr("style")})})},selectColor:function(){$(".colorPicker").colorPicker({customBG:"#222",init:function(a,b){a.style.backgroundColor=a.value;a.style.color=.22<b.rgbaMixCustom.luminance?"#222":"#ddd"}})},checkSelete:function(){$(".tm_check").on("click",function(){$(this).toggleClass("labal-checked");$(this).find(".ui-ico-check").toggleClass("ui-checked")})},showColBox:function(){var a=this;$("#tm_spriderBtn").on("click",function(){var b=$("<input type='text' autofocus style='width:100%;height:20px;font-size:13px;border:2px solid #ccc;' placeHolder='\u8bf7\u8f93\u5165\u91c7\u96c6\u5730\u5740'>");
$.dialog.confirm({title:"\u8bf7\u8f93\u5165\u91c7\u96c6\u5730\u5740",content:b,btnText:"\u91c7\u96c6",move:!0,notAutoHide:!0,callback:function(c){var d=$.trim(b.val());c.result&&(tools.isEmpty(d)?tools.tip({content:"\u8bf7\u8f93\u5165\u91c7\u96c6\u5730\u5740",timeout:2}):-1===d.indexOf("mp.weixin.qq.com")?tools.tip({content:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u516c\u4f17\u5e73\u53f0\u7f51\u5740",timeout:2}):(-1===d.indexOf("http://")&&(d="http://"+d),tools.showLoading(),$.ajax({type:"post",url:"/sprider",
data:{url:d},success:function(b){var d=$.trim(b);tools.isNotEmpty(d)?(b=b.replace(/data-src/g,"src"),a.UE.setContent(b),tools.hideLoading(),c.dialogObj.remove(),c.layer.remove()):$.dialog.alert({type:"warning",move:!0,content:"\u91c7\u96c6\u7684\u7f51\u5740\u4e0d\u5b58\u5728\uff0c\u6216\u662f\u5185\u5bb9\u4e3a\u7a7a"})}})))}})})},moveFixedTools:function(){var a=$("#J-fixedTools");tools.move({moveBar:a,startCallback:function(){a.css({right:"auto",bottom:"auto"})}})},windowScroll:function(){var a=this;
$(window).scroll(function(){a.editTools.is(":visible")&&a.editTools.hide();a.editorIframe.find(".wx96Diy").removeClass("cur")})},editorScroll:function(){var a=this;$(document.getElementById("ueditor_0").contentWindow).scroll(function(){a.editTools.is(":visible")&&a.editTools.hide();a.editorIframe.find(".wx96Diy").removeClass("cur")})},scrollLoadPic:function(){var a=this;$("#tm_tagContent").scroll(function(){a.loadPic()})},loadPic:function(){var a=$("#tm_tagContent"),b=a.offset().top+510;a.find(".con-tag-wrap.on .96wx-img").each(function(){var a=
$(this),d=a.attr("original");!tools.isEmpty(d)&&a.get(0).getBoundingClientRect().top<=b&&(a.attr("src",d),a.removeAttr("original"))})}}).init()});